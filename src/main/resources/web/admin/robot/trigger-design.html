<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
  <head>
    <th:block th:replace="~{/_include/header}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/triggers.css}" />
    <title>触发器</title>
  </head>
  <body>
    <div class="rb-wrapper rb-fixed-sidebar rb-collapsible-sidebar rb-collapsible-sidebar-hide-logo rb-color-header">
      <th:block th:replace="~{/_include/nav-top}" />
      <th:block th:replace="~{/_include/nav-left-admin :: nav(active='robot-trigger')}" />
      <div class="rb-content">
        <div class="page-head">
          <div class="page-head-title">触发器<span class="sub-title">[[${name ?: '未命名'}]]</span></div>
          <div class="clearfix"></div>
        </div>
        <div class="main-content container-fluid pt-0">
          <div class="card mb-0">
            <div class="card-body">
              <ul class="timeline spare">
                <li class="timeline-item">
                  <div class="timeline-date"><span>当发生动作</span></div>
                  <div class="timeline-content">
                    <form class="simple">
                      <div class="form-group row">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right">源实体</label>
                        <div class="col-12 col-lg-9">
                          <div class="form-control-plaintext text-bold">[[${sourceEntityLabel}]]</div>
                        </div>
                      </div>
                      <div class="form-group row pt-0 pb-0">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right">触发动作</label>
                        <div class="col-12 col-lg-9 pt-1 J_when">
                          <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                            <input class="custom-control-input" type="checkbox" value="1" />
                            <span class="custom-control-label"> 新建时</span>
                          </label>
                          <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                            <input class="custom-control-input" type="checkbox" value="4" />
                            <span class="custom-control-label"> 更新时</span>
                          </label>
                          <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                            <input class="custom-control-input" type="checkbox" value="2" />
                            <span class="custom-control-label"> 删除时</span>
                          </label>
                          <div class="mt-1">
                            <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                              <input class="custom-control-input" type="checkbox" value="16" />
                              <span class="custom-control-label"> 分派时</span>
                            </label>
                            <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                              <input class="custom-control-input" type="checkbox" value="32" />
                              <span class="custom-control-label"> 共享时</span>
                            </label>
                            <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                              <input class="custom-control-input" type="checkbox" value="64" />
                              <span class="custom-control-label"> 取消共享时</span>
                            </label>
                          </div>
                          <div class="mt-1">
                            <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                              <input class="custom-control-input" type="checkbox" value="128" />
                              <span class="custom-control-label"> 审批通过时</span>
                            </label>
                            <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                              <input class="custom-control-input" type="checkbox" value="256" />
                              <span class="custom-control-label"> 审批撤销时 <i class="zmdi zmdi-help zicon down-1" title="审批通过后管理员可以撤销重审" data-toggle="tooltip"></i></span>
                            </label>
                          </div>
                          <div class="mt-1">
                            <div>
                              <label class="custom-control custom-control-sm custom-checkbox custom-control-inline mb-0">
                                <input class="custom-control-input" type="checkbox" value="512" onclick="_handle512Change()" />
                                <span class="custom-control-label"> 定期执行</span>
                              </label>
                            </div>
                            <div class="on-timers mt-1 hide">
                              <div class="input-group input-group-sm">
                                <select class="form-control form-control-sm J_whenTimer1">
                                  <option value="D">每天</option>
                                  <option value="M">每月</option>
                                  <option value="H">每小时</option>
                                </select>
                                <div class="input-group-prepend input-group-append">
                                  <span class="input-group-text">执行</span>
                                </div>
                                <input type="text" class="form-control form-control-sm text-center J_whenTimer2" placeholder="1" />
                                <div class="input-group-append">
                                  <span class="input-group-text">次</span>
                                </div>
                              </div>
                              <p class="form-text">具体实行时间将在你设定的周期内平均分布。例如每天执行2次，其执行时间为 00:00 和 12:00</p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="form-group row">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right">附加过滤条件</label>
                        <div class="col-12 col-lg-9 J_whenFilter">
                          <a class="btn btn-sm btn-link pl-0 text-left down-2">点击设置</a>
                          <p class="form-text mb-0 mt-0">符合过滤条件的数据才会执行操作</p>
                        </div>
                      </div>
                    </form>
                  </div>
                </li>
                <li class="timeline-item">
                  <div class="timeline-date"><span>就执行操作</span></div>
                  <div class="timeline-content">
                    <form class="simple">
                      <div class="form-group row">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right">执行操作</label>
                        <div class="col-12 col-lg-9">
                          <div class="form-control-plaintext text-bold">[[${actionTypeLabel}]]</div>
                        </div>
                      </div>
                      <div class="form-group row">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right">操作内容</label>
                        <div class="col-12 col-lg-9">
                          <div id="react-content">加载中...</div>
                        </div>
                      </div>
                      <div class="form-group row">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right">执行优先级</label>
                        <div class="col-12 col-lg-9">
                          <input type="number" class="form-control form-control-sm" id="priority" th:value="${priority}" th:data-o="${priority}" style="max-width: 200px" />
                          <p class="form-text mb-0">优先级高（数字大）的会被先执行</p>
                        </div>
                      </div>
                    </form>
                  </div>
                </li>
                <li class="timeline-item last">
                  <div class="timeline-content">
                    <form class="simple">
                      <div class="form-group row footer">
                        <label class="col-12 col-lg-3 col-form-label text-lg-right"></label>
                        <div class="col-12 col-lg-9">
                          <button class="btn btn-primary J_save" type="button">保存</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <th:block th:replace="~{/_include/footer}" />
    <script>
      window.__PageConfig = {
        configId: '[[${configId}]]',
        actionType: '[[${actionType}]]',
        sourceEntity: '[[${sourceEntity}]]',
        when: ~~'[[${when}]]',
        whenTimer: '[[${whenTimer}]]',
        whenFilter: $unescape('[[${whenFilter}]]'),
        actionContent: $unescape('[[${actionContent}]]'),
      }
    </script>
    <script th:src="@{/assets/js/rb-advfilter.js}" type="text/babel"></script>
    <script th:src="@{/assets/js/trigger/trigger-design.js}" type="text/babel"></script>
    <script th:if="${actionType == 'FIELDAGGREGATION'}" th:src="@{/assets/js/trigger/trigger.FIELDAGGREGATION.js}" type="text/babel"></script>
    <script th:if="${actionType == 'FIELDWRITEBACK'}" th:src="@{/assets/js/trigger/trigger.FIELDWRITEBACK.js}" type="text/babel"></script>
    <script th:if="${actionType == 'SENDNOTIFICATION'}" th:src="@{/assets/js/trigger/trigger.SENDNOTIFICATION.js}" type="text/babel"></script>
    <script th:if="${actionType == 'AUTOASSIGN'}" th:src="@{/assets/js/trigger/trigger.AUTOASSIGN.js}" type="text/babel"></script>
    <script th:if="${actionType == 'AUTOSHARE'}" th:src="@{/assets/js/trigger/trigger.AUTOSHARE.js}" type="text/babel"></script>
    <script th:if="${actionType == 'AUTOAPPROVAL'}" th:src="@{/assets/js/trigger/trigger.AUTOAPPROVAL.js}" type="text/babel"></script>
  </body>
</html>
